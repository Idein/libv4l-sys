version: '3.4'

services:
  libv4l-build:
    container_name: libv4l-build
    build:
      context: .
      dockerfile: dockerfiles/docker-libv4l-build/Dockerfile
      args:
        - RUST_CHANNEL=${RUST_CHANNEL:-stable}
    command: |
      bash -xc "
      rustc --version
      cargo build
      cargo build --examples
      "

  libv4l-test:
    container_name: libv4l-build
    build:
      context: .
      dockerfile: dockerfiles/docker-libv4l-build/Dockerfile
      args:
        - RUST_CHANNEL=${RUST_CHANNEL:-stable}
    command: |
      bash -xc "
      rustc --version
      cargo test --all
      "

  libv4l-build-cross-armhf:
    container_name: libv4l-build-cross-armhf
    build:
      context: .
      dockerfile: dockerfiles/docker-libv4l-build-cross-armhf/Dockerfile
      args:
        - RUST_CHANNEL=${RUST_CHANNEL:-stable}
    command: |
      bash -xc "
      rustc --version
      cargo build --target=arm-unknown-linux-gnueabihf
      cargo build --target=arm-unknown-linux-gnueabihf --examples
      "
